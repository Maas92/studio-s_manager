{
  "info": {
    "name": "Studio S Manager API Tests",
    "description": "Complete API test collection for all services",
    "schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
  },
  "auth": {
    "type": "bearer",
    "bearer": [
      {
        "key": "token",
        "value": "{{accessToken}}",
        "type": "string"
      }
    ]
  },
  "variable": [
    {
      "key": "baseUrl",
      "value": "http://localhost:4000",
      "type": "string"
    },
    {
      "key": "authUrl",
      "value": "http://localhost:5002",
      "type": "string"
    },
    {
      "key": "backendUrl",
      "value": "http://localhost:4001",
      "type": "string"
    },
    {
      "key": "accessToken",
      "value": "",
      "type": "string"
    },
    {
      "key": "userId",
      "value": "",
      "type": "string"
    }
  ],
  "item": [
    {
      "name": "1. Auth Service Tests",
      "item": [
        {
          "name": "1.1 Signup (Owner)",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "if (pm.response.code === 201) {",
                  "    const res = pm.response.json();",
                  "    pm.environment.set('userId', res.data.user.id);",
                  "    pm.test('User created successfully', () => {",
                  "        pm.expect(res.status).to.eql('success');",
                  "        pm.expect(res.data.user).to.have.property('email');",
                  "    });",
                  "}"
                ]
              }
            }
          ],
          "request": {
            "auth": {
              "type": "noauth"
            },
            "method": "POST",
            "header": [],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"email\": \"owner@studios.com\",\n  \"password\": \"Test123!@#\",\n  \"firstName\": \"Studio\",\n  \"lastName\": \"Owner\",\n  \"role\": \"owner\"\n}",
              "options": {
                "raw": {
                  "language": "json"
                }
              }
            },
            "url": {
              "raw": "{{baseUrl}}/auth/signup",
              "host": ["{{baseUrl}}"],
              "path": ["auth", "signup"]
            }
          }
        },
        {
          "name": "1.2 Login",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "if (pm.response.code === 200) {",
                  "    const res = pm.response.json();",
                  "    ",
                  "    // Extract JWT from cookie",
                  "    const cookies = pm.cookies.all();",
                  "    const jwtCookie = cookies.find(c => c.name === 'jwt');",
                  "    if (jwtCookie) {",
                  "        pm.environment.set('accessToken', jwtCookie.value);",
                  "    }",
                  "    ",
                  "    pm.test('Login successful', () => {",
                  "        pm.expect(res.status).to.eql('success');",
                  "        pm.expect(res.data.user).to.have.property('email');",
                  "    });",
                  "}"
                ]
              }
            }
          ],
          "request": {
            "auth": {
              "type": "noauth"
            },
            "method": "POST",
            "header": [],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"email\": \"owner@studios.com\",\n  \"password\": \"Test123!@#\"\n}",
              "options": {
                "raw": {
                  "language": "json"
                }
              }
            },
            "url": {
              "raw": "{{baseUrl}}/auth/login",
              "host": ["{{baseUrl}}"],
              "path": ["auth", "login"]
            }
          }
        },
        {
          "name": "1.3 Get Current User (/auth/me)",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Should return current user', () => {",
                  "    const res = pm.response.json();",
                  "    pm.expect(res.status).to.eql('success');",
                  "    pm.expect(res.data).to.have.property('email');",
                  "});"
                ]
              }
            }
          ],
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/auth/me",
              "host": ["{{baseUrl}}"],
              "path": ["auth", "me"]
            }
          }
        },
        {
          "name": "1.4 Refresh Token",
          "request": {
            "auth": {
              "type": "noauth"
            },
            "method": "POST",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/auth/refresh",
              "host": ["{{baseUrl}}"],
              "path": ["auth", "refresh"]
            }
          }
        },
        {
          "name": "1.5 Logout",
          "request": {
            "method": "POST",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/auth/logout",
              "host": ["{{baseUrl}}"],
              "path": ["auth", "logout"]
            }
          }
        }
      ]
    },
    {
      "name": "2. Products API",
      "item": [
        {
          "name": "2.1 Create Product",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "if (pm.response.code === 201) {",
                  "    const res = pm.response.json();",
                  "    pm.environment.set('productId', res.data.product.id);",
                  "    pm.test('Product created', () => {",
                  "        pm.expect(res.status).to.eql('success');",
                  "    });",
                  "}"
                ]
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"sku\": \"PROD-001\",\n  \"name\": \"Moisturizing Cream\",\n  \"cost_cents\": 1500,\n  \"price_cents\": 3500,\n  \"retail\": true,\n  \"active\": true\n}",
              "options": {
                "raw": {
                  "language": "json"
                }
              }
            },
            "url": {
              "raw": "{{baseUrl}}/products",
              "host": ["{{baseUrl}}"],
              "path": ["products"]
            }
          }
        },
        {
          "name": "2.2 Get All Products",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/products?page=1&limit=10",
              "host": ["{{baseUrl}}"],
              "path": ["products"],
              "query": [
                {
                  "key": "page",
                  "value": "1"
                },
                {
                  "key": "limit",
                  "value": "10"
                }
              ]
            }
          }
        },
        {
          "name": "2.3 Get Product by ID",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/products/{{productId}}",
              "host": ["{{baseUrl}}"],
              "path": ["products", "{{productId}}"]
            }
          }
        },
        {
          "name": "2.4 Update Product",
          "request": {
            "method": "PATCH",
            "header": [],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"price_cents\": 4000,\n  \"active\": true\n}",
              "options": {
                "raw": {
                  "language": "json"
                }
              }
            },
            "url": {
              "raw": "{{baseUrl}}/products/{{productId}}",
              "host": ["{{baseUrl}}"],
              "path": ["products", "{{productId}}"]
            }
          }
        },
        {
          "name": "2.5 Search Products",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/products?search=cream&retail=true",
              "host": ["{{baseUrl}}"],
              "path": ["products"],
              "query": [
                {
                  "key": "search",
                  "value": "cream"
                },
                {
                  "key": "retail",
                  "value": "true"
                }
              ]
            }
          }
        }
      ]
    },
    {
      "name": "3. Treatments API",
      "item": [
        {
          "name": "3.1 Create Treatment",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "if (pm.response.code === 201) {",
                  "    const res = pm.response.json();",
                  "    pm.environment.set('treatmentId', res.data.treatment.id);",
                  "}"
                ]
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"name\": \"Deep Tissue Massage\",\n  \"description\": \"Therapeutic massage targeting deep muscle layers\",\n  \"durationMinutes\": 60,\n  \"price\": 85.00,\n  \"category\": \"Massage Therapy\",\n  \"benefits\": [\"Pain relief\", \"Improved circulation\", \"Stress reduction\"],\n  \"isActive\": true\n}",
              "options": {
                "raw": {
                  "language": "json"
                }
              }
            },
            "url": {
              "raw": "{{baseUrl}}/treatments",
              "host": ["{{baseUrl}}"],
              "path": ["treatments"]
            }
          }
        },
        {
          "name": "3.2 Get All Treatments",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/treatments",
              "host": ["{{baseUrl}}"],
              "path": ["treatments"]
            }
          }
        },
        {
          "name": "3.3 Get Treatment by ID",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/treatments/{{treatmentId}}",
              "host": ["{{baseUrl}}"],
              "path": ["treatments", "{{treatmentId}}"]
            }
          }
        },
        {
          "name": "3.4 Update Treatment",
          "request": {
            "method": "PATCH",
            "header": [],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"price\": 95.00,\n  \"isActive\": true\n}",
              "options": {
                "raw": {
                  "language": "json"
                }
              }
            },
            "url": {
              "raw": "{{baseUrl}}/treatments/{{treatmentId}}",
              "host": ["{{baseUrl}}"],
              "path": ["treatments", "{{treatmentId}}"]
            }
          }
        }
      ]
    },
    {
      "name": "4. Inventory API",
      "item": [
        {
          "name": "4.1 Get Inventory Levels",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/inventory/levels",
              "host": ["{{baseUrl}}"],
              "path": ["inventory", "levels"]
            }
          }
        },
        {
          "name": "4.2 Adjust Inventory (Add Stock)",
          "request": {
            "method": "POST",
            "header": [],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"product_id\": \"{{productId}}\",\n  \"location_id\": \"{{locationId}}\",\n  \"quantity_change\": 50,\n  \"reason\": \"Initial stock\"\n}",
              "options": {
                "raw": {
                  "language": "json"
                }
              }
            },
            "url": {
              "raw": "{{baseUrl}}/inventory/adjust",
              "host": ["{{baseUrl}}"],
              "path": ["inventory", "adjust"]
            }
          }
        },
        {
          "name": "4.3 Transfer Stock",
          "request": {
            "method": "POST",
            "header": [],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"product_id\": \"{{productId}}\",\n  \"from_location_id\": \"{{locationId}}\",\n  \"to_location_id\": \"{{locationId2}}\",\n  \"quantity\": 10,\n  \"reason\": \"Stock transfer\"\n}",
              "options": {
                "raw": {
                  "language": "json"
                }
              }
            },
            "url": {
              "raw": "{{baseUrl}}/inventory/transfer",
              "host": ["{{baseUrl}}"],
              "path": ["inventory", "transfer"]
            }
          }
        }
      ]
    },
    {
      "name": "5. Sales API",
      "item": [
        {
          "name": "5.1 Create Sale",
          "request": {
            "method": "POST",
            "header": [],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"clientId\": \"{{clientId}}\",\n  \"items\": [\n    {\n      \"id\": \"1\",\n      \"type\": \"product\",\n      \"name\": \"Moisturizing Cream\",\n      \"price\": 35.00,\n      \"quantity\": 2,\n      \"productId\": \"{{productId}}\",\n      \"staffId\": \"{{userId}}\",\n      \"staffName\": \"Studio Owner\"\n    }\n  ],\n  \"discount\": {\n    \"type\": \"percentage\",\n    \"value\": 10\n  },\n  \"payments\": [\n    {\n      \"method\": \"card\",\n      \"amount\": 63.00\n    }\n  ]\n}",
              "options": {
                "raw": {
                  "language": "json"
                }
              }
            },
            "url": {
              "raw": "{{baseUrl}}/api/v1/sales",
              "host": ["{{baseUrl}}"],
              "path": ["api", "v1", "sales"]
            }
          }
        }
      ]
    },
    {
      "name": "6. Clients API",
      "item": [
        {
          "name": "6.1 Create Client",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "if (pm.response.code === 201) {",
                  "    const res = pm.response.json();",
                  "    pm.environment.set('clientId', res.data.client.id);",
                  "}"
                ]
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"name\": \"Jane Doe\",\n  \"email\": \"jane@example.com\",\n  \"phone\": \"+1234567890\"\n}",
              "options": {
                "raw": {
                  "language": "json"
                }
              }
            },
            "url": {
              "raw": "{{baseUrl}}/api/v1/clients",
              "host": ["{{baseUrl}}"],
              "path": ["api", "v1", "clients"]
            }
          }
        },
        {
          "name": "6.2 Search Clients",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/api/v1/clients?q=Jane",
              "host": ["{{baseUrl}}"],
              "path": ["api", "v1", "clients"],
              "query": [
                {
                  "key": "q",
                  "value": "Jane"
                }
              ]
            }
          }
        }
      ]
    },
    {
      "name": "7. Categories, Suppliers, Locations",
      "item": [
        {
          "name": "7.1 Create Category",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "if (pm.response.code === 201) {",
                  "    const res = pm.response.json();",
                  "    pm.environment.set('categoryId', res.id);",
                  "}"
                ]
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"name\": \"Skincare\"\n}",
              "options": {
                "raw": {
                  "language": "json"
                }
              }
            },
            "url": {
              "raw": "{{baseUrl}}/categories",
              "host": ["{{baseUrl}}"],
              "path": ["categories"]
            }
          }
        },
        {
          "name": "7.2 Create Supplier",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "if (pm.response.code === 201) {",
                  "    const res = pm.response.json();",
                  "    pm.environment.set('supplierId', res.id);",
                  "}"
                ]
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"name\": \"Beauty Supplies Co\",\n  \"email\": \"contact@beautysupplies.com\",\n  \"phone\": \"+1234567890\"\n}",
              "options": {
                "raw": {
                  "language": "json"
                }
              }
            },
            "url": {
              "raw": "{{baseUrl}}/suppliers",
              "host": ["{{baseUrl}}"],
              "path": ["suppliers"]
            }
          }
        },
        {
          "name": "7.3 Create Location",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "if (pm.response.code === 201) {",
                  "    const res = pm.response.json();",
                  "    pm.environment.set('locationId', res.id);",
                  "}"
                ]
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"code\": \"MAIN\",\n  \"name\": \"Main Storage\"\n}",
              "options": {
                "raw": {
                  "language": "json"
                }
              }
            },
            "url": {
              "raw": "{{baseUrl}}/locations",
              "host": ["{{baseUrl}}"],
              "path": ["locations"]
            }
          }
        }
      ]
    },
    {
      "name": "8. Authorization Tests",
      "item": [
        {
          "name": "8.1 Unauthorized Access (No Token)",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Should return 401', () => {",
                  "    pm.expect(pm.response.code).to.eql(401);",
                  "});"
                ]
              }
            }
          ],
          "request": {
            "auth": {
              "type": "noauth"
            },
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/products",
              "host": ["{{baseUrl}}"],
              "path": ["products"]
            }
          }
        },
        {
          "name": "8.2 Forbidden Access (Wrong Role)",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Should return 403', () => {",
                  "    pm.expect(pm.response.code).to.eql(403);",
                  "});"
                ]
              }
            }
          ],
          "request": {
            "method": "DELETE",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/products/{{productId}}",
              "host": ["{{baseUrl}}"],
              "path": ["products", "{{productId}}"]
            },
            "description": "Try to delete as non-owner (should fail if logged in as manager/therapist)"
          }
        }
      ]
    }
  ]
}